<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Profil — LoveNow</title>
<meta name="description" content="Profil public LoveNow"/>
<link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" as="style" onload="this.rel='stylesheet'"/>
<style>
:root{--bg:#0f1115;--card:#171922;--muted:#aab1c3;--text:#e9edf6;--brand:#ff2d55;--brand2:#7a5cf0;--line:#202334}
*{box-sizing:border-box}html,body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui}
.wrap{max-width:860px;margin:0 auto;padding:16px}
header{position:sticky;top:0;z-index:5;background:rgba(15,17,21,.7);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid var(--line)}
nav{display:flex;gap:8px;align-items:center;padding:10px 0}
.btn{display:inline-flex;align-items:center;justify-content:center;padding:.55rem .85rem;border-radius:.6rem;background:#232739;border:1px solid #2b2f44;cursor:pointer}
.btn-primary{background:linear-gradient(135deg,var(--brand),var(--brand2));border:none}
.card{background:var(--card);border:1px solid var(--line);border-radius:.9rem;padding:16px}
.hero{display:grid;grid-template-columns:160px 1fr;gap:14px}
.hero img{width:160px;height:160px;border-radius:14px;object-fit:cover;background:#0c0e12}
.muted{color:var(--muted)}
</style>
<script src="config.js"></script>
</head>
<body>
<header>
  <div class="wrap">
    <nav>
      <a class="btn" href="index.html">← Accueil</a>
      <strong>Profil</strong>
      <span style="flex:1"></span>
      <a class="btn" href="conversations.html">Conversations</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <div class="card hero">
    <img id="photo" alt="Photo de profil">
    <div>
      <h1 id="name">Utilisateur</h1>
      <div class="muted" id="meta">—</div>
      <p id="bio" style="margin-top:10px"></p>
      <div style="display:flex;gap:8px;margin-top:8px">
        <a id="btnMsg" class="btn btn-primary" href="#">Envoyer un message</a>
      </div>
    </div>
  </div>
</main>

<script type="module">
const $=s=>document.querySelector(s);
const uid = new URLSearchParams(location.search).get("id");

const cfg = window.APP_CONFIG?.firebase;
const siteKey = window.APP_CONFIG?.appCheck?.recaptchaV3SiteKey;

import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { initializeAppCheck, ReCaptchaV3Provider } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app-check.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const app = getApps().length ? getApp() : initializeApp(cfg);
if (siteKey) initializeAppCheck(app,{provider:new ReCaptchaV3Provider(siteKey),isTokenAutoRefreshEnabled:true});
const auth = getAuth(app);
const db   = getFirestore(app);

async function load(){
  if(!uid){ location.href="index.html"; return; }
  const snap = await getDoc(doc(db,"profiles",uid));
  const p = snap.exists()? snap.data() : {};

  $("#photo").src = p.photoURL || "https://images.unsplash.com/photo-1502685104226-ee32379fefbe?q=80&w=800&auto=format&fit=crop";
  $("#name").textContent = p.name || "Utilisateur";
  const age = (p.age!=null) ? `${p.age} ans` : "";
  const city= p.city || "";
  const gender = p.gender || "";
  $("#meta").textContent = [age, city, gender].filter(Boolean).join(" · ") || "—";
  $("#bio").textContent  = p.bio || "";

  $("#btnMsg").href = `conversations.html?with=${encodeURIComponent(uid)}`;
}
load();

onAuthStateChanged(auth,(u)=>{
  // s'il n'est pas connecté, on laisse quand même voir le profil public;
  // le bouton message ouvrira conversations.html qui gèrera l'auth/vérif
});
</script>
</body>
</html>
<!doctype html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Profil — LoveNow</title>
  <meta name="description" content="Profil public LoveNow"/>
  <link rel="stylesheet" href="/styles/tokens.css">
  <link rel="stylesheet" href="/styles/components.css">
  <script src="/js/features.js"></script>
  <script src="config.js"></script>
  <script defer src="/js/ui.js"></script>
  <style>
    *{box-sizing:border-box}
    html,body{margin:0;min-height:100%;background:var(--bg);color:var(--text);font-family:'Manrope',system-ui,sans-serif}
    main{padding-bottom:72px}
    .public-shell{width:min(880px,92vw);margin:60px auto 96px;display:grid;gap:24px}
    .public-profile{display:grid;gap:24px;align-items:center}
    @media(min-width:720px){.public-profile{grid-template-columns:220px 1fr}}
    .public-profile img{width:220px;height:220px;border-radius:32px;object-fit:cover;box-shadow:0 30px 60px -40px rgba(47,22,52,0.4)}
    .public-profile h1{margin:0;font-size:2rem}
    .profile-meta{font-size:1rem;color:var(--muted);margin-top:6px}
    .cta{display:flex;gap:12px;flex-wrap:wrap;margin-top:18px}
  </style>
</head>
<body>
<header class="site-header">
  <div class="wrap nav-bar">
    <a class="brand" href="/" aria-label="LoveNow">
      <img src="/assets/brand/logo.svg" alt="Logo LoveNow" />
      <span>LoveNow</span>
    </a>
    <button class="nav-toggle" type="button" aria-expanded="false" aria-controls="primary-menu" data-toggle-nav>
      <span></span>
      <span class="sr-only">Ouvrir le menu</span>
    </button>
    <nav id="primary-menu" class="site-menu" aria-label="Navigation principale">
      <a href="/#discover">Découvrir</a>
      <a href="/matchmaking.html">Matching</a>
      <a href="/conversations.html">Conversations</a>
      <a href="/profile.html">Mon profil</a>
      <a href="/blog/index.html">Blog</a>
    </nav>
    <button class="mode-toggle" type="button" data-toggle-theme aria-label="Basculer le mode d'affichage">
      <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
        <path d="M12 3a1 1 0 0 1 1 1v1.1a1 1 0 0 1-1 1h-.2a1 1 0 0 1-1-.8 3 3 0 0 0-2.9 2.9 1 1 0 0 1-.8 1H6a1 1 0 0 1-1-1A7 7 0 0 1 12 3Z" />
        <path d="M7 12a5 5 0 1 0 10 0 5 5 0 0 0-10 0Z" />
      </svg>
      <span>Mode</span>
    </button>
  </div>
</header>

<main>
  <div class="public-shell">
    <div class="page-card public-profile">
      <img id="photo" alt="Photo de profil">
      <div>
        <h1 id="name">Utilisateur</h1>
        <p class="profile-meta" id="meta">—</p>
        <p id="bio" class="muted"></p>
        <div class="cta">
          <a id="btnMsg" class="btn" href="#">Envoyer un message</a>
          <a class="btn ghost" href="/">Voir d’autres profils</a>
        </div>
      </div>
    </div>
  </div>
</main>

<footer>
  <div class="wrap footer-card">
    <small>© LoveNow — Profil public</small>
    <div class="footer-links">
      <a href="/privacy.html">Confidentialité</a>
      <a href="/cgu.html">CGU</a>
      <a href="/index.html#discover">Découvrir</a>
    </div>
  </div>
</footer>

<script type="module">
const $=s=>document.querySelector(s);
const uid = new URLSearchParams(location.search).get("id");

const cfg = window.APP_CONFIG?.firebase;

import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const app = getApps().length ? getApp() : initializeApp(cfg);
loadAppCheck(app);
const auth = getAuth(app);
const db   = getFirestore(app);

async function load(){
  if(!uid){ location.href="index.html"; return; }
  const snap = await getDoc(doc(db,"profiles",uid));
  const p = snap.exists()? snap.data() : {};

  $("#photo").src = p.photoURL || "https://images.unsplash.com/photo-1502685104226-ee32379fefbe?q=80&w=800&auto=format&fit=crop";
  $("#name").textContent = p.name || "Utilisateur";
  const age = (p.age!=null) ? `${p.age} ans` : "";
  const city= p.city || "";
  const gender = p.gender || "";
  $("#meta").textContent = [age, city, gender].filter(Boolean).join(" · ") || "—";
  $("#bio").textContent  = p.bio || "";

}
load();
let currentUser=null;
onAuthStateChanged(auth,u=>{ currentUser=u; });
const btnMsg=document.getElementById('btnMsg');
btnMsg.addEventListener('click',e=>{
  e.preventDefault();
  if(!currentUser){ location.href='login.html#login'; return; }
  if(!currentUser.emailVerified){ alert('Vérifie ton e-mail pour discuter.'); return; }
  location.href=`conversations.html?startWith=${uid}`;
});
</script>
<script>loadCrispIfEnabled();</script>
</body>
</html>

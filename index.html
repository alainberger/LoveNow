<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LoveNow ‚Äî Rencontres gratuites, proches de vous</title>
  <meta name="description" content="LoveNow : cr√©ez votre compte gratuitement, compl√©tez votre profil et √©changez en toute confiance." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0d0d10; --panel:#151921; --line:#222a35; --txt:#f6f8fa; --muted:#aeb6c2;
      --acc:#ff4d6d; --acc2:#8f51ea; --ok:#2bd576; --warn:#f7b955; --err:#ff6b6b;
      --r:14px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--txt);font-family:'Poppins',system-ui,Segoe UI,Arial}
    a{color:inherit}
    .wrap{max-width:1100px;margin:0 auto;padding:16px 18px}
    header{position:sticky;top:0;z-index:10;backdrop-filter:saturate(140%) blur(8px);
      background:linear-gradient(180deg,rgba(0,0,0,.65),rgba(0,0,0,.35));border-bottom:1px solid var(--line)}
    .row{display:flex;gap:14px;align-items:center;justify-content:space-between}
    .logo{font-weight:800;color:var(--acc);letter-spacing:.3px}
    .btn{display:inline-block;border-radius:999px;padding:10px 16px;font-weight:800;border:1px solid #fff8;color:#000;background:#fff;cursor:pointer}
    .btn.secondary{background:#0f1320;color:#fff;border:1px solid #ffffff22}
    .btn.danger{background:linear-gradient(90deg,#ff6b6b,#ff8b6b);color:#101217}
    .muted{color:var(--muted)}
    .hero{display:grid;place-items:center;min-height:82vh;text-align:center;padding:30px 18px;
      background:radial-gradient(1200px 600px at 10% 10%,rgba(255,77,109,.18),transparent 60%),
                 radial-gradient(1200px 600px at 90% 10%,rgba(143,81,234,.22),transparent 60%),
                 linear-gradient(135deg,var(--acc),#ff6bb5,var(--acc2))}
    .hero h1{font-size:clamp(28px,6vw,48px);margin:8px 0 10px;font-weight:800}
    .pill{border:1px solid #ffffff60;color:#fff;padding:6px 12px;border-radius:999px;font-size:12px;margin:0 5px;display:inline-block}
    .section{padding:50px 18px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--r);padding:18px}
    .grid{display:grid;gap:16px}
    .g-2{grid-template-columns:1fr 1fr}
    @media(max-width:900px){.g-2{grid-template-columns:1fr}}
    input,textarea,select{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--line);background:#0f1320;color:var(--txt)}
    textarea{min-height:96px;resize:vertical}
    .tabs{display:flex;gap:8px;margin-bottom:12px}
    .tab{flex:1;text-align:center;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0f1320;cursor:pointer}
    .tab.active{border-color:#ffffff40;background:#121a2b}
    .alert{margin-top:10px;padding:10px 12px;border-radius:10px;border:1px solid #ffffff20;background:#0f1420}
    .ok{border-color:#2bd57666}
    .err{border-color:#ff6b6b66}
    .hidden{display:none!important}
    .rowx{display:flex;gap:10px;align-items:center}
    .avatar{width:112px;height:112px;border-radius:16px;object-fit:cover;border:1px solid var(--line);background:#0f1320}
    footer{border-top:1px solid var(--line);padding:22px 18px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="wrap row">
      <div class="logo" aria-label="LoveNow">üíò LoveNow</div>
      <nav>
        <button class="btn secondary" id="openAuth">Se connecter / Cr√©er un compte</button>
      </nav>
    </div>
  </header>

  <main id="main">
    <!-- HERO -->
    <section class="hero">
      <div class="wrap">
        <h1>Rencontrez pr√®s de chez vous, simplement</h1>
        <p class="muted">Inscription gratuite, profil v√©rifiable par e-mail, et photo stock√©e de fa√ßon s√©curis√©e. Pas de faux avis, pas de promesses douteuses.</p>
        <div style="margin-top:14px">
          <span class="pill">üîí S√©curis√© par Firebase & App Check</span>
          <span class="pill">üñºÔ∏è Photos via Cloudinary</span>
          <span class="pill">üì± Mobile-first</span>
        </div>
        <div style="margin-top:18px">
          <button class="btn" id="openAuth2">Commencer maintenant</button>
        </div>
      </div>
    </section>

    <!-- PROFIL (visible apr√®s connexion) -->
    <section class="section wrap hidden" id="dashboard">
      <div class="grid g-2">
        <div class="card">
          <h2 style="margin:0 0 8px">Votre compte</h2>
          <div class="muted" id="hello"></div>

          <div class="tabs" style="margin-top:12px">
            <button class="tab active" data-tab="tab-profile">Profil</button>
            <button class="tab" data-tab="tab-photo">Photo</button>
            <button class="tab" data-tab="tab-security">S√©curit√©</button>
          </div>

          <!-- Profil -->
          <div id="tab-profile">
            <form id="profileForm">
              <label>Pseudo (max. 30)</label>
              <input id="pfName" maxlength="30" required />
              <label style="margin-top:8px">Bio (max. 280)</label>
              <textarea id="pfBio" maxlength="280" placeholder="Pr√©sentez-vous en quelques mots‚Ä¶"></textarea>
              <button class="btn" type="submit" id="saveProfileBtn" style="margin-top:10px">Enregistrer le profil</button>
              <div id="pfMsg" class="alert hidden"></div>
            </form>
          </div>

          <!-- Photo -->
          <div id="tab-photo" class="hidden">
            <div class="rowx">
              <img id="avatar" class="avatar" alt="Photo de profil" src="">
              <div style="flex:1">
                <input id="fileInput" type="file" accept="image/*" />
                <button class="btn secondary" id="uploadBtn" style="margin-top:8px">Uploader sur Cloudinary</button>
                <div class="muted" style="margin-top:6px">Formats courants; l‚Äôimage est automatiquement optimis√©e.</div>
              </div>
            </div>
            <div id="upMsg" class="alert hidden"></div>
          </div>

          <!-- S√©curit√© -->
          <div id="tab-security" class="hidden">
            <p class="muted">E-mail : <span id="secEmail">‚Äî</span></p>
            <p class="muted">V√©rification e-mail : <span id="secVerif">‚Äî</span></p>
            <div class="rowx" style="flex-wrap:wrap;gap:8px">
              <button class="btn secondary" id="resendVerif">Renvoyer l‚Äôe-mail de v√©rification</button>
              <button class="btn danger" id="logoutBtn">Se d√©connecter</button>
            </div>
            <div id="secMsg" class="alert hidden"></div>
          </div>
        </div>

        <!-- Panneau Auth -->
        <div class="card">
          <h2 style="margin:0 0 8px">Connexion / Inscription</h2>
          <div class="tabs">
            <button class="tab active" data-tab="signup">Cr√©er un compte</button>
            <button class="tab" data-tab="login">Se connecter</button>
          </div>

          <!-- Sign up -->
          <form id="signupForm">
            <input id="suEmail" type="email" placeholder="Adresse e-mail" required />
            <input id="suPass" type="password" placeholder="Mot de passe (min. 6 caract√®res)" minlength="6" required />
            <input id="suName" type="text" placeholder="Pseudo (max. 30)" maxlength="30" required />
            <textarea id="suBio" placeholder="Votre bio (max. 280 caract√®res)" maxlength="280"></textarea>
            <button class="btn" id="suBtn" type="submit">Cr√©er mon compte</button>
            <div id="suMsg" class="alert hidden"></div>
          </form>

          <!-- Login -->
          <form id="loginForm" class="hidden">
            <input id="liEmail" type="email" placeholder="Adresse e-mail" required />
            <input id="liPass" type="password" placeholder="Mot de passe" required />
            <button class="btn" id="liBtn" type="submit">Se connecter</button>
            <div id="liMsg" class="alert hidden"></div>
          </form>
        </div>
      </div>
    </section>
  </main>

  <footer>
    ¬© <span id="year"></span> LoveNow ‚Äî Donn√©es stock√©es en UE (Firebase) et images via Cloudinary. 18+ uniquement.
  </footer>

  <!-- ===== App JS : Firebase + Cloudinary ===== -->
  <script type="module">
    /* ---------- Firebase SDK (CDN en modules) ---------- */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
    import {
      getAuth, onAuthStateChanged,
      createUserWithEmailAndPassword, signInWithEmailAndPassword,
      signOut, updateProfile, sendEmailVerification
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore, doc, setDoc, getDoc, updateDoc, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import {
      initializeAppCheck, ReCaptchaV3Provider
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js";

    /* ---------- Config Firebase (votre projet actif) ---------- */
    const firebaseConfig = {
      apiKey: "AIzaSyB_-cNA8bxqYCYUp3rUZs-VpiP4DX2wn3M",
      authDomain: "lovenow-officiel.firebaseapp.com",
      projectId: "lovenow-officiel",
      storageBucket: "lovenow-officiel.firebasestorage.app",
      messagingSenderId: "896585801571",
      appId: "1:896585801571:web:cdde87293291dc1900bd56",
      measurementId: "G-QGM25ND7LF"
    };

    /* ---------- Init + App Check reCAPTCHA v3 ---------- */
    const app = initializeApp(firebaseConfig);
    try { getAnalytics(app); } catch(_) {}
    initializeAppCheck(app, {
      provider: new ReCaptchaV3Provider("6LfjpsErAAAAAExN2IvBq-K475TeJooeNzl9liPD"), // votre cl√© site v3
      isTokenAutoRefreshEnabled: true
    });
    const auth = getAuth(app);
    const db   = getFirestore(app);

    /* ---------- Cloudinary (unsigned) ---------- */
    const CLOUD_NAME = "dyqxadd0j";      // votre cloud name
    const UPLOAD_PRESET = "profile_pics"; // votre preset unsigned

    /* ---------- Helpers UI ---------- */
    const $ = s => document.querySelector(s);
    const show  = el => el.classList.remove("hidden");
    const hide  = el => el.classList.add("hidden");
    const msg   = (el, text, ok=false) => { el.textContent = text; el.className = "alert " + (ok?"ok":"err"); show(el); };

    /* ---------- Tabs ---------- */
    function setupTabs(){
      document.querySelectorAll(".tabs .tab").forEach(t=>{
        t.addEventListener("click", ()=>{
          const group = t.parentElement;
          group.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
          t.classList.add("active");
          const id = t.dataset.tab;
          // cache / affiche contenus fr√®res
          const container = group.parentElement;
          container.querySelectorAll(":scope > [id^='tab-'], :scope > form").forEach(x=>hide(x));
          const tgt = container.querySelector("#"+id) || container.querySelector("form#"+id);
          if(tgt) show(tgt);
        });
      });
    }
    setupTabs();

    /* ---------- Ouvrir la zone d'auth / dashboard ---------- */
    ["#openAuth","#openAuth2"].forEach(sel=>{
      const b = $(sel);
      if(b) b.addEventListener("click", ()=>{ show($("#dashboard")); window.scrollTo({top: $("#dashboard").offsetTop - 20, behavior:"smooth"}); });
    });

    /* ---------- Auth : inscription ---------- */
    $("#signupForm")?.addEventListener("submit", async (e)=>{
      e.preventDefault();
      const email = $("#suEmail").value.trim();
      const pass  = $("#suPass").value;
      const name  = $("#suName").value.trim().slice(0,30);
      const bio   = $("#suBio").value.trim().slice(0,280);
      const msgBox= $("#suMsg");
      try{
        $("#suBtn").disabled = true;
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        // Profil Auth
        await updateProfile(cred.user, { displayName: name });
        // Document Firestore
        await setDoc(doc(db, "users", cred.user.uid), {
          displayName: name, bio, email,
          photoURL: cred.user.photoURL || "",
          createdAt: serverTimestamp(), updatedAt: serverTimestamp()
        });
        await sendEmailVerification(cred.user);
        msg(msgBox, "Compte cr√©√©. Un e-mail de v√©rification vient d‚Äô√™tre envoy√©.", true);
      }catch(err){
        msg(msgBox, "Erreur : " + (err?.message || err), false);
      }finally{
        $("#suBtn").disabled = false;
      }
    });

    /* ---------- Auth : connexion ---------- */
    $("#loginForm")?.addEventListener("submit", async (e)=>{
      e.preventDefault();
      const email = $("#liEmail").value.trim();
      const pass  = $("#liPass").value;
      const msgBox= $("#liMsg");
      try{
        $("#liBtn").disabled = true;
        await signInWithEmailAndPassword(auth, email, pass);
        msg(msgBox, "Connect√©.", true);
      }catch(err){
        msg(msgBox, "Erreur : " + (err?.message || err), false);
      }finally{
        $("#liBtn").disabled = false;
      }
    });

    /* ---------- D√©connexion ---------- */
    $("#logoutBtn")?.addEventListener("click", ()=> signOut(auth));

    /* ---------- Etat d'auth ---------- */
    onAuthStateChanged(auth, async (user)=>{
      if(!user){
        hide($("#dashboard"));
        return;
      }
      show($("#dashboard"));
      $("#hello").textContent = `Bonjour, ${user.displayName || "utilisateur"} !`;
      $("#secEmail").textContent = user.email || "‚Äî";
      $("#secVerif").textContent = user.emailVerified ? "v√©rifi√© ‚úÖ" : "non v√©rifi√© ‚ùó";
      $("#avatar").src = user.photoURL || "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='112' height='112'><rect width='100%' height='100%' fill='%230f1320'/><text x='50%' y='55%' font-family='Arial' font-size='18' fill='%23ffffff' text-anchor='middle'>Aucun visuel</text></svg>";

      // Charger doc Firestore
      try{
        const snap = await getDoc(doc(db,"users",user.uid));
        if(snap.exists()){
          const u = snap.data();
          $("#pfName").value = u.displayName || user.displayName || "";
          $("#pfBio").value  = u.bio || "";
        }
      }catch(_) {}
    });

    /* ---------- Renvoyer e-mail de v√©rification ---------- */
    $("#resendVerif")?.addEventListener("click", async ()=>{
      const user = auth.currentUser;
      if(!user) return;
      const box = $("#secMsg");
      try{
        await sendEmailVerification(user);
        msg(box, "E-mail de v√©rification renvoy√©.", true);
      }catch(err){ msg(box, "Erreur : " + (err?.message || err)); }
    });

    /* ---------- Sauvegarde profil ---------- */
    $("#profileForm")?.addEventListener("submit", async (e)=>{
      e.preventDefault();
      const user = auth.currentUser;
      if(!user) return;
      const name = $("#pfName").value.trim().slice(0,30);
      const bio  = $("#pfBio").value.trim().slice(0,280);
      const box  = $("#pfMsg");
      try{
        $("#saveProfileBtn").disabled = true;
        await updateProfile(user, { displayName:name });
        await updateDoc(doc(db,"users",user.uid), { displayName:name, bio, updatedAt: serverTimestamp() });
        $("#hello").textContent = `Bonjour, ${name || "utilisateur"} !`;
        msg(box, "Profil mis √† jour.", true);
      }catch(err){ msg(box, "Erreur : " + (err?.message || err)); }
      finally{ $("#saveProfileBtn").disabled = false; }
    });

    /* ---------- Upload Cloudinary ---------- */
    async function uploadToCloudinary(file){
      const form = new FormData();
      form.append("file", file);
      form.append("upload_preset", UPLOAD_PRESET);
      const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, { method:"POST", body:form });
      if(!res.ok) throw new Error("Upload Cloudinary refus√©");
      return await res.json(); // contient secure_url
    }

    $("#uploadBtn")?.addEventListener("click", async (e)=>{
      e.preventDefault();
      const user = auth.currentUser;
      const box = $("#upMsg");
      if(!user) return msg(box, "Veuillez vous connecter.", false);
      const file = $("#fileInput").files[0];
      if(!file) return msg(box, "S√©lectionnez une image.", false);
      try{
        $("#uploadBtn").disabled = true;
        const data = await uploadToCloudinary(file);
        // Mettre √† jour Auth + Firestore
        await updateProfile(user, { photoURL: data.secure_url });
        await updateDoc(doc(db,"users",user.uid), { photoURL: data.secure_url, updatedAt: serverTimestamp() });
        $("#avatar").src = data.secure_url;
        msg(box, "Photo mise √† jour.", true);
      }catch(err){ msg(box, "Erreur : " + (err?.message || err)); }
      finally{ $("#uploadBtn").disabled = false; }
    });

    /* ---------- Petites finitions ---------- */
    document.getElementById("year").textContent = new Date().getFullYear();
  </script>
</body>
</html>
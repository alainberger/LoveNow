<!doctype html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LoveNow ‚Äî Rencontres 100% simples, 18+</title>
  <meta name="description" content="Rencontrez des profils pr√®s de chez vous. Gratuit au d√©part, 18+. Filtres par ville, √¢ge et plus.">
  <link rel="canonical" href="https://lovenow.netlify.app/">
  <meta property="og:title" content="LoveNow ‚Äî Rencontres 18+">
  <meta property="og:description" content="Profils en temps r√©el, messages s√©curis√©s.">
  <meta property="og:url" content="https://lovenow.netlify.app/">
    <meta property="og:image" content="/assets/og-default.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="stylesheet" href="/styles/tokens.css">
    <link rel="stylesheet" href="/styles/components.css">
    <link rel="icon" href="/assets/brand/logo.svg" type="image/svg+xml">
    <link rel="manifest" href="/public/manifest.json">
    <script src="/js/features.js"></script>
    <script src="config.js"></script>
    <script defer src="/js/ui.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="wrap nav-bar">
      <a class="brand" href="/" aria-label="LoveNow">
        <img src="/assets/brand/logo.svg" alt="Logo LoveNow" />
        <span>LoveNow</span>
      </a>
      <button class="nav-toggle" type="button" aria-expanded="false" aria-controls="primary-menu" data-toggle-nav>
        <span></span>
        <span class="sr-only">Ouvrir le menu</span>
      </button>
      <nav id="primary-menu" class="site-menu" aria-label="Navigation principale">
        <a href="/#discover">D√©couvrir</a>
        <a href="/matchmaking.html">Matching</a>
        <a href="/conversations.html">Conversations</a>
        <a href="/profile.html">Mon profil</a>
        <a href="/privacy.html">Confidentialit√©</a>
        <a href="/cgu.html">CGU</a>
        <div class="session-slot" id="header-session">
          <a class="btn" href="/login.html#signup">Rejoins-nous gratuitement</a>
        </div>
      </nav>
      <button class="mode-toggle" type="button" data-toggle-theme aria-label="Basculer le mode d'affichage">
        <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
          <path d="M12 3a1 1 0 0 1 1 1v1.1a1 1 0 0 1-1 1h-.2a1 1 0 0 1-1-.8 3 3 0 0 0-2.9 2.9 1 1 0 0 1-.8 1H6a1 1 0 0 1-1-1A7 7 0 0 1 12 3Z" />
          <path d="M7 12a5 5 0 1 0 10 0 5 5 0 0 0-10 0Z" />
        </svg>
        <span>Mode</span>
      </button>
    </div>
  </header>

  <div id="verifyBanner" class="banner" hidden>
    <div>Adresse e-mail non v√©rifi√©e.</div>
    <div style="display:flex;gap:8px">
      <button id="btnResend" class="btn">Envoyer le lien</button>
      <button id="btnRefresh" class="btn">Rafra√Æchir</button>
    </div>
  </div>

  <main>
    <section class="hero" id="hero">
      <div class="wrap">
        <div class="hero-content">
          <div class="hero-badges">
            <span class="chip">‚ö° Matching en direct</span>
            <span class="chip">üîê Authentification s√©curis√©e</span>
            <span class="chip">üí¨ Messagerie instantan√©e</span>
          </div>
          <h1>LoveNow, des rencontres modernes et authentiques</h1>
          <p>D√©couvrez des profils v√©rifi√©s pr√®s de chez vous, √©changez en toute confiance et laissez l‚Äôalgorithme de matching faire le reste.</p>
          <div class="actions">
            <a class="btn" href="/login.html#signup">Cr√©er mon compte</a>
            <a class="btn ghost" href="/#discover">Explorer les profils</a>
          </div>
          <p class="muted">18+ uniquement ¬∑ Disponible sur mobile &amp; desktop ¬∑ Notifications e-mail en option</p>
        </div>
        <div class="hero-visual" aria-hidden="true">
          <div class="hero-card">
            <div class="mini-profile">
              <div class="hero-avatar">AN</div>
              <div>
                <strong>Anna, 27</strong>
                <span>Paris ¬∑ Caf√© &amp; concerts</span>
              </div>
            </div>
            <div class="stacked">
              <div class="bubble">üí¨ ¬´ J‚Äôai match√© en quelques minutes et la conversation a tout de suite d√©marr√© ! ¬ª</div>
              <div class="bubble">98% profils v√©rifi√©s</div>
            </div>
            <div class="stacked">
              <div class="bubble">üéØ Filtres avanc√©s</div>
              <div class="bubble">üîî Alertes discr√®tes</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="discover" aria-labelledby="discover-title">
      <div class="wrap">
        <h2 id="discover-title">D√©couvrir des profils</h2>
        <p class="lead">Affinez votre recherche par genre, √¢ge ou ville et envoyez un message d√®s que vous avez un match.</p>
        <form id="filters" class="filters" onsubmit="return false">
          <div>
            <label for="gender">Genre</label>
            <select id="gender" name="gender">
              <option value="">Tous</option>
              <option value="f">Femme</option>
              <option value="m">Homme</option>
              <option value="o">Autre</option>
            </select>
          </div>
          <div>
            <label for="ageMin">√Çge min</label>
            <input id="ageMin" name="ageMin" type="number" min="18" max="99" inputmode="numeric" placeholder="18">
          </div>
          <div>
            <label for="ageMax">√Çge max</label>
            <input id="ageMax" name="ageMax" type="number" min="18" max="99" inputmode="numeric" placeholder="35">
          </div>
          <div>
            <label for="city">Ville</label>
            <input id="city" name="city" type="text" placeholder="Paris, Lyon‚Ä¶">
          </div>
          <div class="actions">
            <button class="btn" id="btnSearch" type="button">Rechercher</button>
            <button class="btn ghost" id="btnReset" type="button">R√©initialiser</button>
          </div>
        </form>
        <div id="results" class="cards" aria-live="polite"></div>
        <p id="empty-hint" class="muted" style="display:none">Ajuste les filtres ou compl√®te ton profil pour voir plus de r√©sultats.</p>
      </div>
    </section>
  </main>

  <div id="toast" role="status" aria-live="polite"></div>

  <footer>
    <div class="wrap footer-card">
      <small>¬© LoveNow ‚Äî Rencontres responsables &amp; inclusives</small>
      <div class="footer-links">
        <a href="/privacy.html">Confidentialit√©</a>
        <a href="/cgu.html">CGU</a>
        <a href="/legal/cookies.html">Cookies</a>
        <a href="/blog/index.html">Blog</a>
      </div>
    </div>
  </footer>

  <script type="module">
    const cfg = window.APP_CONFIG?.firebase;
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { getFirestore, collection, query, where, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const app = initializeApp(cfg);
    loadAppCheck(app);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    const $ = s=>document.querySelector(s);
    const resultsEl=$('#results'), emptyHintEl=$('#empty-hint'), toast=$('#toast');
    const verifyBanner=$('#verifyBanner'), btnResend=$('#btnResend'), btnRefresh=$('#btnRefresh');

    let currentUser=null;

    let toastTimer;
    const showToast = msg=>{
      toast.textContent = msg;
      toast.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>toast.classList.remove('show'),2200);
    };
    function renderSkeletons(n=6){
      resultsEl.innerHTML=Array.from({length:n}).map(()=>'<div class="skel" aria-hidden="true"></div>').join('');
      emptyHintEl.style.display='block';
    }
    const DEMO=[
      {uid:'demo1',name:'Alice',age:25,city:'Paris',bio:'Profil d√©mo'},
      {uid:'demo2',name:'Bob',age:30,city:'Lyon',bio:'Profil d√©mo'}
    ];
    function renderCards(items){
      if(!items.length){renderSkeletons();return;}
      emptyHintEl.style.display='none';
      resultsEl.innerHTML=items.map(p=>{
        const id=p.uid||p.id||'';
        const viewLink=currentUser?`/profile-public.html?id=${id}`:'/login.html#login';
        const displayName=p.name||p.displayName||'‚Äî';
        const initials=displayName.trim()[0]?.toUpperCase()||'?';
        const photo=p.photoURL||p.photoUrl||'';
        const city=p.city||'‚Äî';
        const age=(p.age??'‚Äî');
        const bio=p.bio?.slice(0,140)||'Ce membre n‚Äôa pas encore r√©dig√© sa pr√©sentation.';
        const avatar=photo?`<img src="${photo}" alt="Photo de ${displayName}">`:`<span>${initials}</span>`;
        return `<article class="card profile-card" tabindex="0" aria-label="Profil de ${displayName}">
          <div class="profile-card__header">
            <div class="profile-card__avatar">${avatar}</div>
            <div class="profile-card__meta">
              <strong>${displayName}</strong>
              <span>${age} ans ¬∑ ${city}</span>
            </div>
          </div>
          <p>${bio}</p>
          <div class="profile-card__actions">
            <a class="btn ghost" href="${viewLink}">Voir le profil</a>
            <button class="btn btnMessage" data-uid="${id}">Envoyer un message</button>
          </div>
        </article>`;
      }).join('');
      resultsEl.querySelectorAll('.btnMessage').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const uid=btn.dataset.uid;
          if(!currentUser){ location.href='/login.html#login'; return; }
          if(!currentUser.emailVerified){ verifyBanner.hidden=false; showToast('V√©rifie ton e-mail pour discuter.'); return; }
          location.href=`/conversations.html?startWith=${uid}`;
        });
      });
    }

    async function fetchProfiles(filters={}){
      const clauses=[];
      if(filters.gender) clauses.push(where('gender','==',filters.gender));
      if(filters.city) clauses.push(where('city','==',filters.city));
      const q=query(collection(db,'profiles'),...clauses,orderBy('createdAt','desc'),limit(200));
      const snap=await getDocs(q);
      return snap.docs.map(d=>d.data());
    }
    function filterByAge(list){
      const min=parseInt($('#ageMin').value,10);
      const max=parseInt($('#ageMax').value,10);
      return list.filter(p=>{
        const a=parseInt(p.age,10);
        if(Number.isFinite(min) && a<min) return false;
        if(Number.isFinite(max) && a>max) return false;
        return true;
      });
    }
    async function apply(filters){
      renderSkeletons();
      try{
        const list=await fetchProfiles(filters);
        const final=filterByAge(list);
        renderCards(final.length?final:DEMO);
      }catch(e){console.error(e);renderCards(DEMO);}
    }

    const state={filters:{}};
    document.getElementById('btnSearch').onclick=()=>{
      const f=document.getElementById('filters');
      state.filters={gender:f.gender.value.trim(),city:f.city.value.trim()};
      const p=new URLSearchParams();
      const vals={gender:state.filters.gender,ageMin:f.ageMin.value.trim(),ageMax:f.ageMax.value.trim(),city:state.filters.city};
      for(const [k,v] of Object.entries(vals)){if(v) p.set(k,v);} history.replaceState({},'',p.toString()?`?${p}`:location.pathname);
      apply(state.filters);
    };
    document.getElementById('btnReset').onclick=()=>{document.getElementById('filters').reset();state.filters={};history.replaceState({},'',location.pathname);renderCards([]);showToast('Filtres r√©initialis√©s');};

    renderSkeletons();
    apply(state.filters);

    onAuthStateChanged(auth, user=>{
      currentUser=user;
      const slot=document.getElementById('header-session');
      if(user){
        const initial=(user.displayName||user.email||'?')[0].toUpperCase();
        slot.innerHTML=`<a href="/profile.html" class="ghost btn">${initial}</a> <button class="ghost btn" id="btnSignOut">Se d√©connecter</button>`;
        document.getElementById('btnSignOut').onclick=()=>signOut(auth);
        if(!user.emailVerified){
          verifyBanner.hidden=false;
          btnResend.onclick=async()=>{
            try{const actionCodeSettings={url:'https://lovenow.netlify.app/login.html?verified=1',handleCodeInApp:false};await sendEmailVerification(user,actionCodeSettings);alert('Lien envoy√© ‚úÖ');}catch(e){alert('√âchec envoi lien');}
          };
          btnRefresh.onclick=()=>location.reload();
        }else{
          verifyBanner.hidden=true;
        }
      }else{
        slot.innerHTML=`<a href="/login.html#signup" class="btn">Rejoins-nous gratuitement</a>`;
        verifyBanner.hidden=true;
      }
    });
  </script>
  <script>loadCrispIfEnabled();</script>
  <script>
    if (window.__FEATURES__?.PWA_ENABLED && 'serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js');
      });
    }
  </script>
</body>
</html>

<!doctype html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LoveNow — Mon profil</title>
  <meta name="description" content="Éditez votre profil LoveNow : prénom/pseudo, ville, âge, bio.">
  <link rel="canonical" href="https://lovenow.netlify.app/profile">
  <meta property="og:title" content="LoveNow — Mon profil">
  <meta property="og:description" content="Mettez à jour votre profil LoveNow.">
  <meta property="og:url" content="https://lovenow.netlify.app/profile">
  <meta property="og:image" content="/assets/og-default.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <style>
    body{ margin:0; font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial; color:#111 }
    .wrap{ max-width:760px; margin:0 auto; padding:24px 16px }
    label{ font-weight:600; display:block; margin-top:10px }
    input,textarea,select{ width:100%; padding:.6rem .7rem; border:1px solid #ddd; border-radius:10px }
    textarea{ min-height:120px }
    .btn{ margin-top:12px; display:inline-block; padding:.65rem 1rem; border-radius:10px; border:1px solid transparent; background:#0AAEEF; color:#fff; font-weight:600 }
    .muted{ color:#666 }
    :focus{ outline:3px auto; outline-offset:2px }
    #toast{ position:fixed; left:50%; transform:translateX(-50%); bottom:14px; background:#111; color:#fff; padding:.7rem 1rem; border-radius:10px; display:none }
  </style>
</head>
<body>
  <div class="wrap">
    <a href="/" aria-label="Retour accueil">← Accueil</a>
    <h1>Mon profil</h1>
    <form id="profileForm">
      <label for="name">Prénom/Pseudo</label>
      <input id="name" required>
      <label for="city">Ville</label>
      <input id="city" placeholder="Paris">
      <label for="age">Âge</label>
      <input id="age" type="number" min="18" max="99" required>
      <label for="gender">Genre</label>
      <select id="gender">
        <option value="">—</option><option value="f">Femme</option><option value="m">Homme</option><option value="o">Autre</option>
      </select>
      <label for="bio">Bio</label>
      <textarea id="bio" maxlength="600" placeholder="Parlez un peu de vous…"></textarea>
      <button class="btn" id="btnSave" type="submit">Enregistrer</button>
    </form>
  </div>

  <div id="toast" role="status" aria-live="polite"></div>

  <script src="/config.js"></script>
  <script type="module">
    import { onAuthStateChanged, getProfileDoc, updateProfileDoc } from '/js/firebase.js';
    const $ = s=>document.querySelector(s);
    const toast = document.getElementById('toast');
    const showToast = m => { toast.textContent=m; toast.style.display='block'; setTimeout(()=>toast.style.display='none', 2200); };

    onAuthStateChanged(async (u)=>{
      if(!u) { location.href='/login.html#signup'; return; }
      const doc = await getProfileDoc(u.uid);
      if(doc){
        $('#name').value = doc.displayName||'';
        $('#city').value = doc.city||'';
        $('#age').value = doc.age||'';
        $('#gender').value = doc.gender||'';
        $('#bio').value = doc.bio||'';
      }
    });

    document.getElementById('profileForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const btn = document.getElementById('btnSave'); btn.disabled=true; const t=btn.textContent; btn.textContent='Enregistrement…';
      try{
        await updateProfileDoc({
          displayName: $('#name').value.trim(),
          city: $('#city').value.trim(),
          age: parseInt($('#age').value,10),
          gender: $('#gender').value,
          bio: $('#bio').value.trim()
        });
        showToast('Profil enregistré');
      }catch(ex){ alert(ex?.message||'Erreur'); }
      finally{ btn.disabled=false; btn.textContent=t; }
    });
  </script>
</body>
</html>